"use strict";(function(root,factory){if(typeof define==="function"&&define.amd){define(["jQuery"],factory)}else if(typeof module==="object"&&module.exports){module.exports=factory(require("jQuery"))}else{root.DromModal=factory(root.jQuery)}})(this,function($){var DromModal=function(options){this.options=$.extend({type:"markup",html:"",src:"",trigger:false,close:false,closeOutside:options.type==="youtube",openOnInit:false,removeOnClose:true,beforeOpen:function(){},afterOpen:function(){},beforeClose:function(){},afterClose:function(){},afterInit:function(){}},options);this._init()};DromModal.prototype={constructor:DromModal,_scrollTop:0,_iOSFix:false,_classList:{htmlActive:"js-modal-active",htmlActiveIOSFix:"js-modal-active_iOSFix",modalActive:"b-modal_active",modalLoading:"b-modal_loading",modalOutsidePos:"b-modal__close_position_outside"},open:function($el){if($el!==undefined){var href=$el.attr("href");if(this.options.type==="youtube"&&/youtube(?:\.com)/.test(href)){this.tpl.$content.find("[data-iframe]").attr("src",href)}this.$triggerEl=$el}this._scrollTop=this.$body.scrollTop();this.options.beforeOpen.call(this);this.$html.addClass(this._classList.htmlActive);if(this._iOSFix){this.$html.addClass(this._classList.htmlActiveIOSFix)}this.$body.append(this.tpl.$root);this.tpl.$root.addClass(this._classList.modalActive);this._attachEvents();this.options.afterOpen.call(this)},loading:function(isLoading){if(isLoading===undefined){isLoading=true}if(isLoading){this.tpl.$root.addClass(this._classList.modalLoading)}else{this.tpl.$root.removeClass(this._classList.modalLoading)}},close:function(){this.options.beforeClose.call(this);this.tpl.$root.removeClass(this._classList.modalActive);if(this.options.removeOnClose){this.tpl.$root.remove()}this.$html.removeClass(this._classList.htmlActive);if(this._iOSFix){this.$html.removeClass(this._classList.htmlActiveIOSFix)}this.options.afterClose.call(this);if(this._iOSFix){this.$body.scrollTop(this._scrollTop)}},_init:function(){var opts=this.options;var self=this;var iOSVersion=this._getIOSVersion();this._iOSFix=iOSVersion&&iOSVersion<10;this._initTpl();if(opts.trigger){$(document).on("click",opts.trigger,function(ev){ev.preventDefault();self.open($(this))})}switch(opts.type){case"youtube":this._initIframe();break;case"markup":this.tpl.$content.append($("<div>").html(opts.html));break;default:console.warn("Unknown content type: "+opts.type)}this.options.afterInit.call(this);if(this.options.openOnInit){this.open()}},_isIOS:function(){var userAgent=navigator.userAgent||navigator.vendor||window.opera;return/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream},_getIOSVersion:function(){if(!this._isIOS()){return false}var match=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);var version=null;if(match!==undefined&&match!==null){version=[parseInt(match[1],10),parseInt(match[2],10),parseInt(match[3]||0,10)];return parseFloat(version.join("."))}return false},_attachEvents:function(){var target;this.tpl.$root.find("[data-wrapper]").on("mousedown",function(ev){target=ev.target}).on("mouseup",function(ev){if(ev.target===target&&ev.currentTarget===target){this.close()}}.bind(this));this.tpl.$close.on("click",this.close.bind(this));if(this.options.close){var $el=this.tpl.$root.find(this.options.close);if($el.length){$el.on("click",this.close.bind(this))}}},_initTpl:function(){var tpl={$root:null,$content:null,$close:null};var $modalTpl=$("[data-drom-modal]");this.$html=$("html");this.$body=$("body");if($modalTpl.length){tpl.$root=$modalTpl.clone().removeAttr("data-drom-modal")}else{tpl.$root=$('<div class="b-modal b-modal_reset">'+'<div class="b-modal__overlay"></div>'+'<div class="b-modal__wrapper" data-wrapper>'+'<div class="b-modal__content" data-content>'+'<div class="b-modal__close" data-close></div>'+"</div>"+"</div>"+"</div>")}tpl.$content=tpl.$root.find("[data-content]");tpl.$close=tpl.$root.find("[data-close]");if(this.options.closeOutside){tpl.$close.addClass(this._classList.modalOutsidePos)}this.tpl=tpl},_initIframe:function(){this.tpl.$content.append('<div class="b-modal__iframe-scaler">'+'<iframe data-iframe src="" class="b-modal__iframe" '+'frameborder="0" vspace="0" hspace="0" webkitallowfullscreen '+'mozallowfullscreen allowfullscreen scrolling="auto"></iframe>'+"</div>")}};return DromModal});
