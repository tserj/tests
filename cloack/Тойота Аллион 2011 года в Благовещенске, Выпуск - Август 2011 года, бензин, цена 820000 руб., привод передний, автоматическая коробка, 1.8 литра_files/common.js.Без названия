if(!Object.keys){Object.keys=function(obj){"use strict";var arr=[],key;for(key in obj){if(obj.hasOwnProperty(key)){arr.push(key)}}return arr}}function getCookie(cname){var name=cname+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)===" ")c=c.substring(1);if(c.indexOf(name)===0)return c.substring(name.length,c.length)}return""}function setCookie(name,value,options){options=options||{};var expires=options.expires;if(typeof expires=="number"&&expires){var d=new Date;d.setTime(d.getTime()+expires*1e3);expires=options.expires=d}if(expires&&expires.toUTCString){options.expires=expires.toUTCString()}value=encodeURIComponent(value);var updatedCookie=name+"="+value;for(var propName in options){updatedCookie+="; "+propName;var propValue=options[propName];if(propValue!==true){updatedCookie+="="+propValue}}document.cookie=updatedCookie}var _requireCssCache={};function requirecss(file){var cacheKey=file.match(/[a-z]+/g).join("");if(_requireCssCache[cacheKey])return;_requireCssCache[cacheKey]=1;var link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=file;document.getElementsByTagName("head")[0].appendChild(link)}function decode_string(coded_string){var out="";for(var k in coded_string){out+="&#"+(255-coded_string[k])+";"}return out}function isValidEmail(email){return/^([a-z0-9_\-]+\.)*[a-z0-9_\-]+@([a-z0-9][a-z0-9\-]*[a-z0-9]\.)+[a-z]{2,4}$/i.test(email)}function number2Word(number,for1,for2,for10){ten=number%100;one=number%10;if(one>0&&one<5&&(ten<11||ten>20)){if(one==1){return for1}return for2}return for10}DromCore={};DromCore.reachGoal=function(goal,callback){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new window.XMLHttpRequest}else{try{xmlhttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(E){xmlhttp=false}}}if(typeof callback==="function"){xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){callback()}}}xmlhttp.open("GET",(window.location.protocol==="https:"?"https:":"http:")+"//www.drom.ru/dummy.txt?goal="+goal,true);xmlhttp.send(null)};function check_comments_form(form_id,is_registered){var err="",form_obj=document.getElementById(form_id);if(!is_registered){if(document.getElementById("username_warning").innerHTML.length===0){err+="Это имя уже занято!\n"}if(form_obj.nickname.value.length===0){err+="Введите имя!\n"}if(!isValidEmail(form_obj.email.value)){err+="Введите правильный e-mail!\n"}}if(form_obj.comment_text.value.length===0){err+="Введите текст комментария!\n"}if(err.length>0){window.alert(err);return false}return true}function our_common_ajax_processor(object_link,is_inner,ajax_data,loading_callback,url){var req=new Subsys_JsHttpRequest_Js;req.onreadystatechange=function(){if(req.readyState==4||req.readyState=="complete"){if(req.responseJS){if(is_inner){object_link.innerHTML=req.responseJS.out}else{object_link.innerHTML="";object_link.outerHTML=req.responseJS.out}}}if(typeof loading_callback!="undefined"&&loading_callback.length>0){var fn=window[loading_callback];if(typeof fn=="function"){fn(object_link,is_inner,req)}}};req.caching=true;req.open("POST",(typeof url).toLowerCase()=="string"?url:(window.location.protocol==="https:"?"https:":"http:")+"//www.drom.ru/process_ajax_request.php",true);if(ajax_data){req.send(ajax_data)}}function post_our_email(email,text,what_event){if(what_event!="onMouseOver")what_event="onClick";if(email[1]&&email[2]){document.write("<span "+what_event+"=\"our_common_ajax_processor(this, true, { 'mode' : 'get_email', 'm1' : '"+email[0]+"', 'm2' : '"+email[1]+"', 'm3' : '"+email[2]+'\' }); return false;"><a href="mailto:">'+text+"</a></span>")}else if(email[0]){document.write("<span "+what_event+"=\"our_common_ajax_processor(this, true, { 'mode' : 'get_email', 'm1' : '"+email[0]+'\' }); return false;"><a href="mailto:">'+text+"</a></span>")}}function post_email(email,text,what_event){if(what_event!="onMouseOver")what_event="onClick";if(email[1]&&email[2]){document.write("<span "+what_event+"=\"our_common_ajax_processor(this, true, { 'mode' : 'get_email', 'm1' : '"+email[0]+"', 'm2' : '"+email[1]+"', 'm3' : '"+email[2]+'\' }); return false;"><a href="mailto:">'+text+"</a></span>")}else if(email[0]){document.write("<span "+what_event+"=\"our_common_ajax_processor(this, true, { 'mode' : 'get_email', 'm1' : '"+email[0]+'\' }); return false;"><a href="mailto:">'+text+"</a></span>")}}var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4)}return output},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}output=Base64._utf8_decode(output);return output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext},_utf8_decode:function(utftext){var string="",i=0,c=0,c1=0,c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return string}};function Subsys_JsHttpRequest_Js(){this._construct()}(function(){var COUNT=0;var PENDING={};var CACHE={};Subsys_JsHttpRequest_Js.dataReady=function(id,text,js){var undef;var th=PENDING[id];delete PENDING[id];if(th){delete th._xmlReq;if(th.caching)CACHE[th.hash]=[text,js];th._dataReady(text,js)}else if(typeof th!=typeof undef){alert("ScriptLoader: unknown pending id: "+id)}};Subsys_JsHttpRequest_Js.prototype={onreadystatechange:null,readyState:0,responseText:null,responseXML:null,status:200,statusText:"OK",session_name:"PHPSESSID",responseJS:null,caching:false,_span:null,_id:null,_xmlReq:null,_openArg:null,_reqHeaders:null,dummy:function(){},abort:function(){if(this._xmlReq)return this._xmlReq.abort();if(this._span){this.readyState=0;if(this.onreadystatechange)this.onreadystatechange();this._cleanupScript()}},open:function(method,url,asyncFlag,username,password){this._openArg={method:method,url:url,asyncFlag:asyncFlag,username:username,password:password};this._id=null;this._xmlReq=null;this._reqHeaders=[];return true},send:function(content){var id=(new Date).getTime()+""+COUNT++;var query=this._hash2query(content);var url=this._openArg.url;var sid=this._getSid();if(sid)url+=(url.indexOf("?")>=0?"&":"?")+this.session_name+"="+this.escape(sid);var hash=this.hash=url+"?"+query;if(this.caching&&CACHE[hash]){var c=CACHE[hash];this._dataReady(c[0],c[1]);return false}this._xmlReq=this._obtainXmlReq(id,url);var hasSetHeader=this._xmlReq&&(window.ActiveXObject||this._xmlReq.setRequestHeader);var href,body;if(this._xmlReq&&hasSetHeader&&(""+this._openArg.method).toUpperCase()=="POST"){this._openArg.method="POST";href=url;body=query}else{this._openArg.method="GET";href=url+(url.indexOf("?")>=0?"&":"?")+query;body=null}href=href+(href.indexOf("?")>=0?"&":"?")+id;PENDING[id]=this;if(this._xmlReq){var a=this._openArg;this._xmlReq.open(a.method,href+"-xml",a.asyncFlag,a.username,a.password);if(hasSetHeader){for(var i=0;i<this._reqHeaders.length;i++)this._xmlReq.setRequestHeader(this._reqHeaders[i][0],this._reqHeaders[i][1]);this._xmlReq.setRequestHeader("Content-Type","application/octet-stream")}return this._xmlReq.send(body)}else{this._obtainScript(id,href);return true}},getAllResponseHeaders:function(){if(this._xmlReq)return this._xmlReq.getAllResponseHeaders();return""},getResponseHeader:function(label){if(this._xmlReq)return this._xmlReq.getResponseHeader(label);return""},setRequestHeader:function(label,value){this._reqHeaders[this._reqHeaders.length]=[label,value]},_construct:function(){},_dataReady:function(text,js){with(this){if(text!==null||js!==null){readyState=4;responseText=responseXML=text;responseJS=js}else{readyState=0;responseText=responseXML=responseJS=null}if(onreadystatechange)onreadystatechange();_cleanupScript()}},_obtainXmlReq:function(id,url){if(url.match(new RegExp("^[a-z]+://","i")))return null;var req=null;if(window.XMLHttpRequest){try{req=new XMLHttpRequest}catch(e){}}else if(window.ActiveXObject){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}if(!req)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}if(req){var th=this;req.onreadystatechange=function(){var s=req.readyState;if(s==4){req.onreadystatechange=th.dummy;var responseText=req.responseText;try{eval(responseText)}catch(e){Subsys_JsHttpRequest_Js.dataReady(id,"JavaScript code generated by backend is invalid!\n"+responseText,null)}}else{th.readyState=s;if(th.onreadystatechange){th.onreadystatechange()}}};this._id=id}return req},_obtainScript:function(id,href){with(document){var span=null;with(document){span=body.appendChild(createElement("SPAN"));span.innerHTML="text for ie";span.appendChild(createElement("SCRIPT"));span.style.display="none";setTimeout(function(){var s=span.getElementsByTagName("script")[0];s.type="text/javascript";if(s.setAttribute){s.setAttribute("src",href)}else{s.src=href}},10)}this._id=id;this._span=span}},_cleanupScript:function(){var span=this._span;if(span){this._span=null;setTimeout(function(){span.parentNode.removeChild(span)},50)}return false},_hash2query:function(content,prefix){prefix=prefix||"";var query=[];if(content instanceof Object){for(var k in content){var v=content[k];if(v===null||((v.constructor||{}).prototype||{})[k]){continue}var curPrefix=prefix?prefix+"["+this.escape(k)+"]":this.escape(k);if(v instanceof Object){query[query.length]=this._hash2query(v,curPrefix)}else{query[query.length]=curPrefix+"="+this.escape(v)}}}else{query=[content]}return query.join("&")},_getSid:function(){var m=document.location.search.match(new RegExp("[&?]"+this.session_name+"=([^&?]*)"));var sid=null;if(m){sid=m[1]}else{m=document.cookie.match(new RegExp(s="(;|^)\\s*"+this.session_name+"=([^;]*)"));if(m)sid=m[2]}return sid},escape:function(s){return escape(s).replace(new RegExp("\\+","g"),"%2B")}}})();if(typeof console==="undefined"){var console={log:function(){},dir:function(){}}}var n=navigator.userAgent.toLowerCase();if($.browser===undefined){$.browser={};$.browser.mozilla=/mozilla/.test(n)&&!/webkit    /.test(n);$.browser.webkit=/webkit/.test(n);$.browser.opera=/opera/.test(n);$.browser.msie=/msie/.test(n)}$.browser.safari4=$.browser.webkit&&!!n.match(/version\/4\./g);$.browser.mobile=!!n.match("mobile");var count_tr=0;$(function(){$(".topline.close-btn, [data-topline-close]").click(function(){var cookiesData=document.cookie.split("; "),hiddenToplines=[],expires=new Date,id=$(this).data("id"),curCookie="";if(cookiesData.length>0){$.each(cookiesData,function(index,value){if(value.indexOf("hidden_toplines_ids")>=0){hiddenToplines=value.split(",")}})}hiddenToplines.push(id);expires.setDate(expires.getDate()+5);curCookie="hidden_toplines_ids="+hiddenToplines.join(",")+"; expires="+expires.toGMTString()+"; path=/; domain=.drom.ru";document.cookie=curCookie;$(this).parent().hide();return false});if($.browser.opera){$("body").addClass("opera");if(parseFloat($.browser.version)&&parseFloat($.browser.version)<10.5){$("body").addClass("operaOld")}}if($.browser.safari4){$("body").addClass("safari4");$(".cf, .clearfix").after('<div class="clear">&nbsp;</div>')}var reviewAdd=$(".reviews .add");if(reviewAdd.length){$(".blackButtons .i_add").hover(function(){reviewAdd.toggleClass("addHover")});reviewAdd.hover(function(){$(".blackButtons .i_add").toggleClass("i_add_hover")})}var reviewsInterval=0;var markDefText="";$(".mark .select a").hover(function(){markDefText=$(".mark .select span").text();$(".mark .select span").text($(this).attr("alt"))},function(){$(".mark .select span").text(markDefText)});$(".reviewAdd .name").click(function(){var item=$(this).parent();if(!item.hasClass("sales")){return false}if(item.toggleClass("itemFull").hasClass("itemFull")){$(".full",item).slideDown();$("span.threeDots").toggleClass("hidden")}else{$(".full",item).slideUp(function(){$("span.threeDots").toggleClass("hidden")})}return false});$(".smallSearch .i").focus(function(){if($(this).val()==="поиск по разделу"){$(this).val("")}});$(".smallSearch :submit").bind("mousedown mouseup",function(){$(".smallSearch :submit").toggleClass("pressed")});if($(".pager .s").length>0){$(".pager .s").prevUntil(".prev").addClass("past")}$(".accordion .a").click(function(){if(!$(this).hasClass("as")){var strt="";var strt2="";var strt3="";if($(this).attr("id")==="average"){strt3='id="average"';$("#average_ar").hide()}else{$("#average_ar").show()}if($(".accordion .as").attr("id")==="average"){strt='id="average_ar"';strt2='id="average"'}if($(".accordion .as").attr("id")==="average"){$("#average_ar").show()}$(".accordion .as").replaceWith("<a class='a' href='#' onclick='openAccordion(this); return false;' "+strt2+">"+$(".accordion .as").html()+"</a>");$(".accordion .c").slideUp("fast");$(this).addClass("as").next().slideDown("fast");$(this).replaceWith("<span class='a as' "+strt3+">"+$(this).html()+"</span>");$("body").focus()}return false});var files=$("form .files");if(files.length){var tr=files.find("tr:first").clone();tr.find("input").val("");$(".add",files).click(function(){if(files.find("tr").length<files.attr("max")){var index_file=files.find("tr").length+1;count_tr++;if(index_file>=3){$(".add",files).empty()}var clone='<tr><td><input type="text" name="video_url[]" size="75"/><a href="#" class="del" onclick="filesDelClone(this); return false;">&nbsp;</a></td></tr>';$(this).parents(".files:first").find("table").append(clone)}return false});$(".del",files).click(function(){$(this).parents("tr:first").remove();count_tr--;if(count_tr<3){$(".add",files).html("Добавить поле")}})}$(".comments .item .q").click(function(){pasteQ($(this).attr("title"),$(this).parent().find("div:first").html());return false});if($.fn.lightBox){var max=1200;if($(window)&&$(window).width()<1200){max=$(window).width()*.9375}else if(screen&&screen.width&&screen.width<1200){max=960}$("#bigImage, .auto .img .cf a").lightBox({allwaysShowControls:true,maxImageWidth:max});if($(".catalogImages").length>0){$(".catalogImages").lightBox({allwaysShowControls:true,maxImageWidth:max})}}$(".auto .img .cf a").unbind("click");$(document).on("click",".like-block",function(){var linkObj,linkPhBlock,likePostData={mode:"like_photo"},likeIco,likeCounter,$this=$(this);linkObj=$(this).siblings("a");linkPhBlock=$(this).parent();likeIco=$(this).find(".like");likeCounter=$(this).find(".like-counter");likePostData.section=linkObj.attr("data-section")||false;likePostData.image_id=linkObj.attr("data-image-id")||false;if(!likePostData.section||!likePostData.image_id){likePostData.section=linkPhBlock.attr("data-section")||false;likePostData.image_id=linkPhBlock.attr("data-image-id")||false}if(!likePostData.section||!likePostData.image_id){console.log("like for photo is disabled: required attributes data-section & data-image-id not provided");return}if($(this).hasClass("inactive")){return}$.ajax({url:"//www.drom.ru/process_ajax_request.php",data:likePostData,dataType:"jsonp",jsonp:"jsoncallback",success:function(data){if(data["result"]){likeCounter.text(data["msg"]);$this.addClass("inactive")}else{console.log(data["msg"])}},error:function(jqXHR,textStatus,errorThrown){console.log("image like AJAX error: "+errorThrown)}})})});$(document).on({click:function(e){if($(this).attr("img")===$("#bigImage img").attr("src")){return false}if($(this).data("image-hash")){$("#bigImage").data("image-hash",$(this).data("image-hash"))}$("#bigImage img").fadeTo(1500,.1);$("#bigImage").attr("href",$(this).attr("href"));$("<img/>").one("load",function(){$("#bigImage img").attr("src",this.src);if(this.getAttribute("srcset")){$("#bigImage img").attr("srcset",this.getAttribute("srcset"))}$("#bigImage img").stop(true,false).fadeTo("fast",1)}).attr({src:$(this).attr("img"),srcset:$(this).attr("data-srcset")});return false},dblclick:function(e){$(this).click();$("#bigImage img").click();return false}},".auto .img .cf a");$(document).on("click",".js-link",function(e){var $link=$(this),href=$link.data("href");document.location.href=href});function openAccordion(link){if(!$(link).hasClass("as")){var strt="";var strt2="";var strt3="";if($(link).attr("id")=="average"){strt3='id="average"';$("#average_ar").hide()}else{$("#average_ar").show()}if($(".accordion .as").attr("id")=="average"){strt='id="average_ar"';strt2='id="average"'}$(".accordion .as").replaceWith("<a class='a' href='#' onclick='openAccordion(this); return false;'  "+strt2+" >"+$(".accordion .as").html()+"</a>");$(".accordion .c").slideUp("fast");$(link).addClass("as").next().slideDown("fast");$(link).replaceWith("<span class='a as' "+strt3+">"+$(link).html()+"</span>");$("body").focus()}}function filesDelClone(element){count_tr--;if(count_tr<3){$("form .add").html("Добавить поле")}$(element).parents("tr:first").remove();return false}function strip_tags(str){str=str.replace(/\s\s/gim," ");return str.replace(/<\/?[^>]+>/gim,"")}function insertAtCaret(textObj,textFieldValue){if(document.all){if(textObj.createTextRange&&textObj.caretPos&&!window.opera){var caretPos=textObj.caretPos;caretPos.text=caretPos.text.charAt(caretPos.text.length-1)==" "?textFieldValue+" ":textFieldValue}else{textObj.value+=textFieldValue}}else{if(textObj.selectionStart){var rangeStart=textObj.selectionStart;var rangeEnd=textObj.selectionEnd;var tempStr1=textObj.value.substring(0,rangeStart);var tempStr2=textObj.value.substring(rangeEnd,textObj.value.length);textObj.value=tempStr1+textFieldValue+tempStr2;textObj.selectionStart=textObj.selectionEnd=rangeStart+textFieldValue.length}else{textObj.value+=textFieldValue}}}function pasteQ(nick,temp_txt){var txt="";var reg=/\s*?<div[^>]*?>\s*?<b>[\s*?\S*?\s*?]*?<\/b>[\s\S]*<\/div>/gim;var reg1=/\s*?<div[^>]*?>\s*?<b>[\s*?\S*?\s*?]*?<\/b>[\s\S]*?<\/div>/gim;txt=temp_txt;found1=txt.match(reg1);while(found1!==null){txt=txt.replace(reg1,"");txt=txt.replace(/\s\s/gim," ");found1=txt.match(reg1)}found=txt.match(reg);while(found!==null){txt=txt.replace(reg,"");txt=txt.replace(/\s\s/gim," ");found=txt.match(reg)}txt=strip_tags(txt);txt="[quote="+nick+"]"+txt+"[/quote]\n";if(txt.length>0&&document.forms["comments_form"]["comment_text"]){insertAtCaret(document.forms["comments_form"]["comment_text"],txt);$("#comment_text").focus()}return false}function showHideVideoBlock(id_panel){if($("#"+id_panel).is(":hidden")){$("#"+id_panel).show()}else{$("#"+id_panel).hide()}return false}function openWindow(link,top_,left_,width_,height_,addition){addition=addition||"location=yes, scrollbars=1";return window.open(link,"","top="+top_+", left="+left_+", width="+width_+", height="+height_+", "+addition)}function render_template(id,params){var template,el=$("#"+id);params=params||{};if(!el.length){console.log("Can't find template "+id);return}if($.inArray(id,$.Mustache.templates())==-1){$.Mustache.add(id,el.html())}template=$($.Mustache.render(id,params));$(document).trigger("template_rendered",{id:id,params:params});return template}function focus(field,namespace){if(namespace===undefined){$(field).focus()}else{$(field,namespace).focus()}}function makeSelectFromArray(a,name,options,html_options){var select=$("<select></select>"),option;options=options||{};html_options=html_options||{};select.attr("name",name);for(var option_name in html_options){select.attr(option_name,html_options[option_name])}if(options.first!==undefined){option=$("<option></option>");option.attr("value",options.first.key);option.html(options.first.value);select.append(option)}for(var i in a){option=$("<option></option>");option.attr("value",i);option.html(a[i]);if(options.selected!==undefined&&i===options.selected){option.attr("selected","selected")}select.append(option)}return select}function parse_url(url){var tokens;if(url===undefined){return}tokens=url.match(/(https?:\/\/)?(:?www\.)?([a-z0-9\-\.]+)\.([a-z]{2,5})(.*)/);return{scheme:tokens[1],www:tokens[2],domain:tokens[3],zone:tokens[4],path:tokens[5]}}function fireEvent(evt){$(document).trigger($.Event(evt.name),evt.data)}function ajax_add_callback(action){var parsed,path;parsed=parse_url(action);if(action===undefined||parsed===undefined){return"/?cb=?"}path=parsed.path;if(path.indexOf("cb=?")!=-1){return action}if(path===undefined){return action+"/?cb=?"}if(path.indexOf("?")==-1){return action+"?cb=?"}return action+"&cb=?"}(function($,g,undefined){var short_url={xhr:undefined,lastchecked:undefined,timeout:undefined,ajax_cache:{}};$(document).on("click",".confirm",function(e){var $this=$(this),rel=$this.attr("rel");if(!confirm(rel)){if(typeof e.stopPropagation=="function"){e.stopPropagation()}return false}});$(document).on("blur keyup paste init","input.validate_email",function(e){var $this=$(this);if(this.value.length===0&&$this.hasClass("allow_empty")&&!$this.hasClass("required")||isValidEmail(this.value)){$this.trigger("valid")}else{$this.trigger("invalid")}});$(document).on("submit","form.validate",function(e){var $this=$(this),invalid_fields=$this.getInvalidFields();if(invalid_fields.length){alert("Пожалуйста, заполните все поля верно");invalid_fields.first().focus();return false}});$(document).on("blur keyup paste init","input.validate_url",function(e){var $this=$(this),allow_empty=!$this.hasClass("required")||$this.hasClass("allow_empty"),url=$this.val(),urlregex=/(?:https?:\/\/)?(?:www\.)?[a-z0-9\-\.]+\.[a-z]{2,5}(?:\/\?.*|\/.*|$)/i,urlregexrf=/(?:https?:\/\/)?(?:www\.)?[а-я0-9\-\.]+\.рф(?:\/\?.*|\/.*|$)/i;if(url.length===0&&allow_empty){$this.trigger("valid");return}if(urlregex.test(url)||urlregexrf.test(url)){$this.trigger("valid")}else{$this.trigger("invalid")}});$(document).on("blur keyup paste init","input.validate_short_url",function(e){var $this=$(this),currchecking=$this.val(),serve_ajax_response=function(response){if(response.status){$this.trigger("valid")}else{$this.trigger("invalid")}};clearTimeout(short_url.timeout);if(short_url.ajax_cache[currchecking]!==undefined){serve_ajax_response(short_url.ajax_cache[currchecking]);return}short_url.timeout=setTimeout(function(){var ajax_data={url:$this.val(),action:"check_short_url"},need_ajax_check=false;currchecking=ajax_data.url;if(currchecking!=short_url.lastchecked||short_url.xhr===undefined){need_ajax_check=true}if(currchecking.length===0){need_ajax_check=false;$this.trigger("valid");short_url.lastchecked=ajax_data.url;return}if(currchecking.length<3){need_ajax_check=false;$this.trigger("invalid");short_url.lastchecked=ajax_data.url;return}if(short_url.xhr!==undefined&&short_url.xhr.readyState!=4&&need_ajax_check){short_url.xhr.abort()}if(need_ajax_check){short_url.xhr=$.post("//my.drom.ru/ajax/?cb=?",ajax_data,function(response){short_url.lastchecked=ajax_data.url;short_url.ajax_cache[ajax_data.url]=response;serve_ajax_response(response)},"json")}},e.type=="blur"||e.type=="init"||e.type=="paste"?0:500)});$.fn.initForm=function(){var $this=$(this);inputs=$('input:not([type="submit"]),textarea,select,button',$this);inputs.trigger("valid");inputs.trigger("init")};$.fn.getInvalidFields=function(){var $this=$(this),fields=$('input:not([type="submit"]),textarea,select,button',$this),invalid_fields=fields.filter(function(index){return $(this).data("valid")===false});return invalid_fields};$(document).on({valid:function(e){$(this).data("valid",true).removeClass("error")},invalid:function(e){$(this).data("valid",false).removeClass("correct").addClass("error")}},"input,textarea");$(document).on("click","span.toggle-ask-question",function(e){var $this=$(this),questions_wrapper=$this.parents("div.questions"),ask_question_wrapper=$("div.ask-question-wrapper",questions_wrapper),name=$("input[name=name]",ask_question_wrapper);ask_question_wrapper.toggleClass("hidden");if(!ask_question_wrapper.hasClass("hidden")){name.focus()}});$(document).on("click","a.ajax-delete-question",function(e){var $this=$(this),question_container=$this.parents("div.question"),question_id=$this.attr("data-question-id"),action=$this.attr("data-action"),ajax_data={question_id:question_id};$.post(ajax_add_callback(action),ajax_data,function(response){},"json")});$(document).on("submit","form.ajax-ask-question-form",function(e){var $this=$(this),questions_wrapper=$this.parents("div.questions"),questions_list_wrapper=$("div.questions_list",questions_wrapper),submit_button=$("input[type=submit]",$this),action=$this.prop("action"),name=$("input[name=name]",$this),email=$("input[name=email]",$this),phone=$("input[name=phone]",$this),question=$("textarea[name=question]",$this),ask_target_id=$("input[name=ask_target_id]",$this),ajax_data={question:question.val(),name:name.val(),email:email.val(),phone:phone.val(),ask_target_id:ask_target_id.val()};if(submit_button.prop("disabled")){return false}submit_button.prop("disabled",true);$.post(ajax_add_callback(action),ajax_data,function(response){var rendered_question;if(response.status===false){alert(response.message)}if(response.status){rendered_question=render_template("question-mustache",response.template_params);questions_list_wrapper.append(rendered_question)}if(response.allow_resubmit){submit_button.prop("disabled",false)}},"json").error(function(xhr,type,descr){alert(descr);submit_button.prop("disabled",false)});return false});$.fn.getHTML=function(s){return s?this.before(s).remove():$("<p>").append(this.eq(0).clone()).html()}})(jQuery,window);function placeZeroPixels(zeropixels){var body=$("body"),img=new Image;img.className="zeropixel";$.each(zeropixels,function(index,zeropixel){img.src=zeropixel;body.append(img)})}(function($,g,undefined){var Modal=function(name,properties){var className="modal-"+name,existing=$(".modal-wrapper."+className);var options={width:350,height:460};if(typeof properties==="object"){$.extend(options,properties)}this.options=options;this.name=name;this.className=className;this.alreadyExists=false;this.waitLoad=false;if(existing.length){this.alreadyExists=true;this.wrapper=existing}else{this.wrapper=$("<div>").addClass("modal-wrapper "+className).append($("<div>").addClass("modal "+className))}this.modal=this.wrapper.find("div:first");return this};Modal.prototype.setContent=function(content,overrideIfExists){overrideIfExists=overrideIfExists||false;content=$(content);if(!this.alreadyExists||overrideIfExists){this.modal.html('<img onclick="javascript: jQuery.mask.close(); " src="//c.rdrom.ru/img_tpl/lightbox/close.png" style="float: right; cursor: pointer;position: absolute;right: -10px;top: -10px;" title="Закрыть">').append(content);$("body").append(this.wrapper)}this.content=content;return this};Modal.prototype.close=function(){$.mask.close()};Modal.prototype.waitLoad=function(){this.waitLoad=true;return this};Modal.prototype.showLoading=function(){var overlay=$("<div>").addClass("overlay upload_load_image").css({display:"block",width:this.modal.width()+"px",height:this.modal.height()+"px",position:"absolute",top:"0px",border:"none"});if(!this.alreadyExists){this.modal.append(overlay)}};Modal.prototype.closeLoading=function(){if(!this.alreadyExists){this.modal.find(".overlay").remove()}};Modal.prototype.show=function(){var self=this,height=self.options.height,width=self.options.width,left=Math.ceil($(g).width()/2-width/2),top=$(g).scrollTop()+80;this.wrapper.css("display","block");this.modal.css({width:width+"px",height:height+"px",margin:"20px auto",position:"relative",display:"block"});this.wrapper.expose({color:"#AAA",loadSpeed:"fast",onClose:function(){this.getExposed().css("display","none");$("body").css("overflow","visible")},onLoad:function(){var dfd=$.Deferred($.proxy(self.showLoading,self));$("body").css("overflow","hidden");dfd.done($.proxy(self.closeLoading,self));this.getExposed().css("display","block");self.modal.css("display","block");self.content.on("load",function(){dfd.resolve()});if(!self.waitLoad){dfd.resolve()}}});return this};Widget={Modal:Modal};g.Widget=Widget})(jQuery,window);$(document).on("click",".avtogoda-widget",function(evt){var $this=$(this),url=$this.data("iframe-popup"),iframe=document.createElement("iframe");iframe.src=url;iframe.setAttribute("scrolling","no");iframe.setAttribute("style","border: none; width: 100%; height: 100%; display: block;");m=new Widget.Modal("avtogoda-widget").setContent(iframe).show();$.post("//www.drom.ru/ajax/stat/avtogoda_click.php",{url:document.location.href,modal:url,class:$this.prop("class")},function(response){},"jsonp")});function premiumWrapHTML(item){if("undefined"!==typeof usePremiumWrapHTMLV2&&usePremiumWrapHTMLV2===true){return premiumWrapHTMLV2(item)}var ItemT={BULL_ID:0,FIRM_ID:1,MODEL_ID:2,YEAR:3,CITY_ID:4,PRICE:5,UPLOADED:6,TITUL_ID:7,IS_PROCESSED:8,SERVER_ID:9,PERIOD:10,FORCED_IMAGE:11,ASSIST_CARD_ID:12,IMAGE_BASE_PATH:13,IS_RETINA_EXISTS:14};var link,firm_model,model_name,name,image_link,img_path,image_set=[],sales_bull_photo_url,titul_id,city_name,year,city_rus_name,price,title_symbol_limit=18,firm_name_url,model_name_url;var imagePrefix={x1:"ttn_160",x2:"ttn_320",x3:"ttn_480"};if(typeof window.premiumWrapNewItemTpl!=="undefined"&&window.premiumWrapNewItemTpl===true){imagePrefix={x1:"gen160wb",x2:"gen320wb",x3:"gen480wb"}}firm_name=drom_js_models_data[item[ItemT.FIRM_ID]][0];model_name=drom_js_models_data[item[ItemT.FIRM_ID]][3][item[ItemT.MODEL_ID]][0];firm_name_url=drom_js_models_data[item[ItemT.FIRM_ID]][1];model_name_url=drom_js_models_data[item[ItemT.FIRM_ID]][3][item[ItemT.MODEL_ID]][1];city_name=cities_data[item[ItemT.CITY_ID]][0];city_rus_name=cities_data[item[ItemT.CITY_ID]][1];price=item[ItemT.PRICE];year=item[ItemT.YEAR];if(bull_link_template){link=bull_link_template;link=link.replace("[BULL_ID]",item[ItemT.BULL_ID])}else{link="//"+city_name+"."+server_name_lc+"/"+firm_name_url+"/"+model_name_url+"/"+item[ItemT.BULL_ID]+".html"}if((firm_name+" "+model_name+" "+year).length<=title_symbol_limit){name=firm_name+" "+model_name+" "+year}else if((model_name+" "+year).length<=title_symbol_limit){name=model_name+" "+year}else if(model_name.length<=title_symbol_limit){name=model_name}else{name=model_name.substring(0,17)+"..."}if(typeof item[ItemT.IMAGE_BASE_PATH]!=="undefined"&&item[ItemT.IMAGE_BASE_PATH].length>0&&item[ItemT.TITUL_ID]){sales_bull_photo_url=item[ItemT.IMAGE_BASE_PATH];titul_id=item[ItemT.TITUL_ID];if(typeof item[ItemT.IS_RETINA_EXISTS]!=="undefined"&&item[ItemT.IS_RETINA_EXISTS]){image_link=sales_bull_photo_url+"/"+imagePrefix["x1"]+"_"+titul_id+".jpg";image_set=[sales_bull_photo_url+"/"+imagePrefix["x2"]+"_"+titul_id+".jpg"+" 2x",sales_bull_photo_url+"/"+imagePrefix["x3"]+"_"+titul_id+".jpg"+" 3x"]}else{image_link=sales_bull_photo_url+"/premium_"+titul_id+".jpg"}}else if(typeof item[ItemT.FORCED_IMAGE]!=="undefined"&&item[ItemT.FORCED_IMAGE].length>0){image_link=item[11]}else if(item[7]){if(item[8]){image_link=image_base_url+item[9]+"/"+sales_photos_dir+Math.ceil(item[0]/1e3)+"/"+item[0]+"/premium_"+item[7]+".jpg";
}else{image_link=process_image_url}}else{image_link=no_image_url}if(typeof window.premiumWrapNewItemTpl!=="undefined"&&window.premiumWrapNewItemTpl===true){return'<a href="'+link+'" class="b-tire-scroll__car" data-premium-item="1">'+'<div class="b-image-cont b-image-cont_bg_reset b-image b-image_theme_tire-scroll" '+'src="'+image_link+'">'+'<img class="b-image-cont__inner b-image b-image_type_fit b-image_fit-cover" '+'src="'+image_link+'" srcset="'+image_set.join(",")+'" data-src="'+image_link+'" '+'data-srcset="'+image_set.join(",")+'" alt="'+city_rus_name+" "+name+'" '+'title="'+city_rus_name+" "+name+'">'+"</div>"+'<div class="b-tire-scroll__town">'+city_rus_name+"</div>"+'<div class="b-tire-scroll__text-link"><span class="b-link">'+name+"</span></div>"+'<div class="b-tire-scroll__price">'+price+"</div>"+(item[ItemT.ASSIST_CARD_ID]!==undefined&&item[ItemT.ASSIST_CARD_ID]?'<div class="b-tire-scroll__sticker b-ico b-ico_type_assist-ico"></div>':"")+"</a>"}var html='<a href="'+link+'" class="b-tire-scroll__car">'+'<div class="b-image b-image_theme_tire-scroll" src="'+image_link+'">'+'<img class="b-image__image" src="'+image_link+'" srcset="'+image_set.join(",")+'" alt="'+city_rus_name+" "+name+'" title="'+city_rus_name+" "+name+'" width="'+premium_image_width+'" height="'+premium_image_height+'">'+"</div>"+'<div class="b-tire-scroll__town">'+city_rus_name+"</div>"+'<div class="b-tire-scroll__text-link"><span class="b-link">'+name+"</span></div>"+'<div class="b-tire-scroll__price">'+price+"</div>"+(item[ItemT.ASSIST_CARD_ID]!==undefined&&item[ItemT.ASSIST_CARD_ID]?'<div class="b-tire-scroll__sticker b-ico b-ico_type_assist-ico"></div>':"")+"</a>";return html}function premiumWrapHTMLV2(item){var ItemT={LINK:0,FIRM_ID:1,MODEL_ID:2,YEAR:3,CITY_ID:4,PRICE:5,PHOTO:6,PHOTO2x:7,PHOTO3x:8,ASSIST_CARD_ID:9};var link,firm_name,model_name,name,image_link,image_set=[],year,city_rus_name,price,title_symbol_limit=18;firm_name=drom_js_models_data[item[ItemT.FIRM_ID]][0];model_name=drom_js_models_data[item[ItemT.FIRM_ID]][3][item[ItemT.MODEL_ID]][0];city_rus_name=cities_data[item[ItemT.CITY_ID]][1];price=item[ItemT.PRICE];year=item[ItemT.YEAR];link=item[ItemT.LINK];if((firm_name+" "+model_name+" "+year).length<=title_symbol_limit){name=firm_name+" "+model_name+" "+year}else if((model_name+" "+year).length<=title_symbol_limit){name=model_name+" "+year}else if(model_name.length<=title_symbol_limit){name=model_name}else{name=model_name.substring(0,17)+"..."}if(item[ItemT.PHOTO]){image_link=item[ItemT.PHOTO];if(item[ItemT.PHOTO2x]){image_set=[item[ItemT.PHOTO2x]+" 2x",item[ItemT.PHOTO3x]+" 3x"]}}else{image_link=no_image_url}return'<a href="'+link+'" class="b-tire-scroll__car" data-premium-item="1">'+'<div class="b-image-cont b-image-cont_bg_reset b-image b-image_theme_tire-scroll" '+'src="'+image_link+'">'+'<img class="b-image-cont__inner b-image b-image_type_fit b-image_fit-cover" '+'src="'+image_link+'" srcset="'+image_set.join(",")+'" data-src="'+image_link+'" '+'data-srcset="'+image_set.join(",")+'" alt="'+city_rus_name+" "+name+'" '+'title="'+city_rus_name+" "+name+'">'+"</div>"+'<div class="b-tire-scroll__town">'+city_rus_name+"</div>"+'<div class="b-tire-scroll__text-link"><span class="b-link">'+name+"</span></div>"+'<div class="b-tire-scroll__price">'+price+"</div>"+(item[ItemT.ASSIST_CARD_ID]!==undefined&&item[ItemT.ASSIST_CARD_ID]?'<div class="b-tire-scroll__sticker b-ico b-ico_type_assist-ico"></div>':"")+"</a>"}function premiumAppendItem(){if(carousel_index==premium_ads.length){carousel_index=0}var item=premium_ads[carousel_index++];var api=$(".tireScroll .scrollable").scrollable();api.getItemWrap().append(premiumWrapHTML(item))}function premiumPrependItem(){var item,api,items;if(carousel_index===0){carousel_index=premium_ads.length}carousel_index--;if(carousel_index-num_ads_preloaded<0){item=premium_ads[premium_ads.length+(carousel_index-num_ads_preloaded)]}else{item=premium_ads[carousel_index-num_ads_preloaded]}api=$(".tireScroll .scrollable").scrollable();items=api.getItemWrap();items.prepend(premiumWrapHTML(item));items.css("left","-160px")}function premiumRemoveItem(move_right){var api=$(".tireScroll .scrollable").scrollable();items=api.getItemWrap();if(move_right===true){items.children(":first").remove()}else{items.children(":last").remove()}items.css("left","0px");return true}function premiumUpdateIndex(){this.setIndex(0)}function premiumInitBem(){var s=$(".tireScroll .scrollable").scrollable({clickable:false,speed:200,size:1,alert:false,onSeek:premiumUpdateIndex,keyboard:false}).scrollable(),prevPage=$("#prevPage"),nextPage=$("#nextPage");prevPage.removeClass("hidden");nextPage.removeClass("hidden");if(premium_ads.length>3){prevPage.click(function(){premiumPrependItem();s.prev(200,function(){premiumRemoveItem(false)});return false});nextPage.click(function(){premiumAppendItem();s.next(200,function(){premiumRemoveItem(true)});return false})}}var ieHomeCheck={url:"",linkId:"sethome",check:function(){var ret=-1;document.body.style.behavior="url(#default#homepage)";if(document.body.isHomePage(this.url)){return 0}return ret},hide:function(){document.getElementById(this.linkId).style.display="none"},action:function(){if(!is_ie())return false;this.URL=location.protocol+"//"+location.hostname+"/";var ret=this.check();if(ret===0){this.hide()}}};function is_ie(){return document.all&&!window.opera&&!document.layers&&document.getElementById}function is_ff(){return netscape&&navigator&&document.getElementById&&!document.all}function setHome(el,url){if(!is_ie()){new Image(1,1).src="//www.drom.ru/ck/?home&fail";return true}new Image(1,1).src="//www.drom.ru/ck/?home&success";if(is_ie()){el.style.behavior="url(#default#homepage)";el.setHomePage(url)}return false}function setHomepage(page){new Image(1,1).src="//www.drom.ru/ck/?home&success";if(document.all){document.body.style.behavior="url(#default#homepage)";document.body.setHomePage(page)}else if(window.sidebar){if(window.netscape){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(e){alert('Слева вверху рядом с надписью "www.drom.ru" есть иконка (красный кружок или глобус). Перетащите ее мышью направо на иконку с домиком.')}}var prefs=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);prefs.setCharPref("browser.startup.homepage",page)}else{var b=getBrowserInfo();if(b.type=="Opera"){alert('Нажмите CTRL-F12, затем кнопку "Текущая страница"')}else if(b.type=="Chrome"){alert('1. Нажмите иконку с гаечным ключом справа вверху\n2. Выберите "Настройки" (в старых версиях "Параметры")\n3. В блоке "Начальная группа"-"Следующие страницы" нажмите "Добавить" и выберите "Drom.ru - автомобильный портал"')}else{alert('1. Нажмите иконку с шестеренкой справа вверху\n2. Выберите "Настройки"\n3. В строке "Начальная страница" нажмите "Текущая страница".')}}}function getBrowserInfo(){var t,v;if(window.chrome)t="Chrome";else if(window.opera)t="Opera";else if(document.all){t="IE";var nv=navigator.appVersion;var s=nv.indexOf("MSIE")+5;v=nv.substring(s,s+1)}else if(navigator.appName)t="Netscape";if(navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1){t="Safari"}return{type:t,version:v}}function bookmark(a){var url=window.document.location;var title=window.document.title;var b=getBrowserInfo();if(b.type=="Safari")alert('Слева вверху рядом с надписью "www.drom.ru" есть иконка (красный кружок или глобус). Перетащите ее на панель закладок.');else if(b.type=="IE"&&9>=b.version&&b.version>=4)window.external.AddFavorite(url,title);else if(b.type=="Opera"||b.type=="Netscape"){a.href=url;a.rel="sidebar";a.title=title;return true}else{alert("Нажмите OK и затем CTRL-D, чтобы добавить страницу в закладки.")}return false}function setFavorite(a){new Image(1,1).src="//www.drom.ru/ck/?fav&success";bookmark(a)}(function(b){b.tools=b.tools||{version:"1.2.5"};var e;e=b.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}};function f(){if(b.browser.msie){var k=b(document).height(),j=b(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,k-j<20?j:k]}return[b(document).width(),b(document).height()]}function h(j){if(j){return j.call(b.mask)}}var i,d,c,a,g;b.mask={load:function(j,l){if(c){return this}if(typeof j=="string"){j={color:j}}j=j||a;a=j=b.extend(b.extend({},e.conf),j);i=b("#"+j.maskId);if(!i.length){i=b("<div/>").attr("id",j.maskId);b("body").append(i)}var k=f();i.css({position:"absolute",top:0,left:0,width:k[0],height:k[1],display:"none",opacity:j.startOpacity,zIndex:j.zIndex});if(j.color){i.css("backgroundColor",j.color)}if(h(j.onBeforeLoad)===false){return this}if(j.closeOnEsc){b(document).bind("keydown.mask",function(m){if(m.keyCode==27){b.mask.close(m)}})}if(j.closeOnClick){i.bind("click.mask",function(m){b.mask.close(m)})}b(window).bind("resize.mask",function(){b.mask.fit()});if(l&&l.length){g=l.eq(0).css("zIndex");b.each(l,function(){var m=b(this);if(!/relative|absolute|fixed/i.test(m.css("position"))){m.css("position","relative")}});d=l.css({zIndex:Math.max(j.zIndex+1,g=="auto"?0:g)})}i.css({display:"block"}).fadeTo(j.loadSpeed,j.opacity,function(){b.mask.fit();h(j.onLoad);c="full"});c=true;return this},close:function(){if(c){if(h(a.onBeforeClose)===false){return this}i.fadeOut(a.closeSpeed,function(){h(a.onClose);if(d){d.css({zIndex:g})}c=false});b(document).unbind("keydown.mask");i.unbind("click.mask");b(window).unbind("resize.mask")}return this},fit:function(){if(c){var j=f();i.css({width:j[0],height:j[1]})}},getMask:function(){return i},isLoaded:function(j){return j?c=="full":c},getConf:function(){return a},getExposed:function(){return d}};b.fn.mask=function(j){b.mask.load(j);return this};b.fn.expose=function(j){b.mask.load(j,this);return this}})(jQuery);(function($){function fireEvent(opts,name,self,arg){var fn=opts[name];if($.isFunction(fn)){try{return fn.call(self,arg)}catch(error){if(opts.alert){alert("Error calling scrollable."+name+": "+error)}else{throw error}return false}}return true}var current=null;function Scrollable(root,conf){var self=this;if(!current){current=self}var horizontal=!conf.vertical;var wrap=$(conf.items,root);var index=0;var navi=root.siblings(conf.navi).eq(0);var prev=root.siblings(conf.prev).eq(0);var next=root.siblings(conf.next).eq(0);var prevPage=root.siblings(conf.prevPage).eq(0);var nextPage=root.siblings(conf.nextPage).eq(0);$.extend(self,{getVersion:function(){return[1,0,1]},setIndex:function(i){index=i},getIndex:function(){return index},getConf:function(){return conf},getSize:function(){return self.getItems().size()},getPageAmount:function(){return Math.ceil(this.getSize()/conf.size)},getPageIndex:function(){return Math.ceil(index/conf.size)},getRoot:function(){return root},getItemWrap:function(){return wrap},getItems:function(){return wrap.children()},seekTo:function(i,time,fn){time=time||conf.speed;if($.isFunction(time)){fn=time;time=conf.speed}if(i<0){i=0}if(i>self.getSize()-conf.size){return self}var item=self.getItems().eq(i);if(!item.length){return self}if(fireEvent(conf,"onBeforeSeek",self,i)===false){return self}if(horizontal){var left=-(item.outerWidth(true)*i);wrap.animate({left:left},time,conf.easing,fn?function(){fn.call(self)}:null)}else{var top=-(item.outerHeight(true)*i);wrap.animate({top:top},time,conf.easing,fn?function(){fn.call(self)}:null)}if(navi.length){var klass=conf.activeClass;var page=Math.ceil(i/conf.size);page=Math.min(page,navi.children().length-1);navi.children().removeClass(klass).eq(page).addClass(klass)}if(i===0){prev.add(prevPage).addClass(conf.disabledClass)}else{prev.add(prevPage).removeClass(conf.disabledClass)}if(i>=self.getSize()-conf.size){next.add(nextPage).addClass(conf.disabledClass)}else{next.add(nextPage).removeClass(conf.disabledClass)}current=self;index=i;fireEvent(conf,"onSeek",self,i);return self},move:function(offset,time,fn){var to=index+offset;if(conf.loop&&to>self.getSize()-conf.size){to=0}return this.seekTo(to,time,fn)},next:function(time,fn){return this.move(1,time,fn)},prev:function(time,fn){return this.move(-1,time,fn)},movePage:function(offset,time,fn){return this.move(conf.size*offset,time,fn)},setPage:function(page,time,fn){var size=conf.size;var index=size*page;var lastPage=index+size>=this.getSize();if(lastPage){index=this.getSize()-conf.size}return this.seekTo(index,time,fn)},prevPage:function(time,fn){return this.setPage(this.getPageIndex()-1,time,fn)},nextPage:function(time,fn){return this.setPage(this.getPageIndex()+1,time,fn)},begin:function(time,fn){return this.seekTo(0,time,fn)},end:function(time,fn){return this.seekTo(this.getSize()-conf.size,time,fn)},reload:function(){return load()},click:function(index,time,fn){var item=self.getItems().eq(index);var klass=conf.activeClass;if(!item.hasClass(klass)&&(index>=0||index<this.getSize())){self.getItems().removeClass(klass);item.addClass(klass);var delta=Math.floor(conf.size/2);var to=index-delta;if(to>self.getSize()-conf.size){to--}if(to!==index){return this.seekTo(to,time,fn)}}return self}});if($.isFunction($.fn.mousewheel)){root.bind("mousewheel.scrollable",function(e,delta){var step=$.browser.opera?1:-1;self.move(delta>0?step:-step,50);return false})}prev.addClass(conf.disabledClass).click(function(){self.prev()});next.click(function(){self.next()});nextPage.click(function(){self.nextPage()});prevPage.addClass(conf.disabledClass).click(function(){self.prevPage()});if(conf.keyboard){$(window).unbind("keypress.scrollable").bind("keypress.scrollable",function(evt){var el=current;if(!el){return}if(horizontal&&(evt.keyCode==37||evt.keyCode==39)){el.move(evt.keyCode==37?-1:1);return evt.preventDefault()}if(!horizontal&&(evt.keyCode==38||evt.keyCode==40)){el.move(evt.keyCode==38?-1:1);return evt.preventDefault()}return true})}function load(){navi.each(function(){var nav=$(this);if(nav.is(":empty")||nav.data("me")==self){nav.empty();nav.data("me",self);for(var i=0;i<self.getPageAmount();i++){var item=$("<"+conf.naviItem+"/>").attr("href",i).click(function(e){var el=$(this);el.parent().children().removeClass(conf.activeClass);el.addClass(conf.activeClass);self.setPage(el.attr("href"));return e.preventDefault()});if(i===0){item.addClass(conf.activeClass)}nav.append(item)}}else{var els=nav.children();els.each(function(i){var item=$(this);item.attr("href",i);if(i===0){item.addClass(conf.activeClass)}item.click(function(){nav.find("."+conf.activeClass).removeClass(conf.activeClass);item.addClass(conf.activeClass);self.setPage(item.attr("href"))})})}});if(conf.clickable){self.getItems().each(function(index,arg){var el=$(this);if(!el.data("set")){el.bind("click.scrollable",function(){self.click(index)});el.data("set",true)}})}if(conf.hoverClass){self.getItems().hover(function(){$(this).addClass(conf.hoverClass)},function(){$(this).removeClass(conf.hoverClass)})}return self}load();var timer=null;function setTimer(){timer=setInterval(function(){self.next()},conf.interval)}if(conf.interval>0){root.hover(function(){clearInterval(timer)},function(){setTimer()});setTimer()}}jQuery.prototype.scrollable=function(conf){var api=this.eq(typeof conf=="number"?conf:0).data("scrollable");if(api){return api}var opts={size:5,vertical:false,clickable:true,loop:false,interval:0,speed:400,keyboard:true,activeClass:"active",disabledClass:"disabled",hoverClass:null,easing:"swing",items:".items",prev:".prev",next:".next",prevPage:".prevPage",nextPage:".nextPage",navi:".navi",naviItem:"a",onBeforeSeek:null,onSeek:null,alert:true};$.extend(opts,conf);this.each(function(){var el=new Scrollable($(this),opts);$(this).data("scrollable",el)});return this}})(jQuery);$(document).on("click","a.trackable",function(evt){var $this=$(this),href=$this.prop("href"),newHref="//www.drom.ru/r.php?trackable=1&url="+encodeURIComponent(href);$this.prop("href",newHref)});function sendOldBrowserChoice(choice,onSuccess,onError){$.ajax({url:(window.location.protocol=="https:"?"https:":"http:")+"//www.drom.ru/common_ajax_processor.php",data:{mode:"oldbrowser_choice",crossdomain_ajax_request:3,choice:choice},xhrFields:{withCredentials:true},type:"POST",dataType:"json",success:onSuccess,error:onError})}function tryToShowNotificationForOldBrowser(){var oldBrowserCookie="oldbrowser";var flag=getCookie(oldBrowserCookie);if(!flag||flag==2){return}var Choice={REMIND_LATER:"remind_later",DOWNLOAD:"download"};var html='<div class="old-browser" data-old-cont="1">            <div class="old-browser__bg"></div>            <div class="old-browser__container">                <div class="old-browser__logo"></div>                <div class="old-browser__heading">К сожалению, ваш браузер<br>больше не поддерживается :(</div>                    <div class="old-browser__text">                        Drom.ru можно просматривать в различных браузерах. Но если вы хотите иметь доступ<br>                        к новейшим функциям нашего сайта, установите современный браузер с полной поддержкой.<br>                        Последние версии поддерживаемых браузеров перечислены ниже.                     </div>                    <div class="old-browser__icons">                        <a class="old-browser__link" href="https://www.mozilla.org/ru/firefox/new/" target="_blank">                            <div class="old-browser__icon old-browser__icon_firefox"></div>                            <div class="old-browser__title">Mozilla<br>Firefox</div>                        </a>                        <a class="old-browser__link" href="https://www.google.com/chrome/" target="_blank">                            <div class="old-browser__icon old-browser__icon_chrome"></div>                            <div class="old-browser__title">Google<br>Chrome</div>                        </a>                        <a class="old-browser__link" href="https://windows.microsoft.com/ru-ru/internet-explorer/download-ie" target="_blank">                            <div class="old-browser__icon old-browser__icon_ie"></div>                            <div class="old-browser__title">Internet<br>Explorer</div>                        </a>                        <a class="old-browser__link" href="https://www.opera.com/download" target="_blank">                            <div class="old-browser__icon old-browser__icon_opera"></div>                            <div class="old-browser__title old-browser__title_center">Opera</div>                        </a>                    </div>                    <a class="old-browser__text-link" href="#" data-old-close="1">Нет, спасибо</a>                </div>            </div>        </div>';if(!$(".old-browser").length){$("body").append(html)}$("[data-old-close]").bind("click",function(e){e.preventDefault();var date=new Date((new Date).getTime()+6048e5);document.cookie=oldBrowserCookie+"=2; path=/; domain=.drom.ru; expires="+date.toUTCString();var container=$("[data-old-cont]");container.fadeOut(300,function(){$(this).remove()});sendOldBrowserChoice(Choice.REMIND_LATER,function(data){},function(jqXHR,textStatus,errorThrown){})});$(".old-browser__link").bind("click",function(e){e.preventDefault();var $this=$(this),location=$this.attr("href");sendOldBrowserChoice(Choice.DOWNLOAD,function(data){window.location.href=location},function(jqXHR,textStatus,errorThrown){window.location.href=location});return false})}$(document).ready(function(){(function isTouch($){var $html=$("html"),$body=$("body"),isTouchSupport="ontouchstart"in window||"DocumentTouch"in window&&document instanceof DocumentTouch;if(isTouchSupport){$html.removeClass("drom-notouch");$html.addClass("drom-touch");$body.attr("ontouchstart","")}else{$html.removeClass("drom-touch");$html.addClass("drom-notouch")}})(jQuery);if($.fn.fancybox){var fancyBoxState={changedByFancyboxNav:false};$("a.fancybox").fancybox({margin:0,padding:0,helpers:{title:{type:"",download:false,counterTpl:"{n1} из {n2}",like:false},smoothScrollZoom:true,overlay:{locked:false,css:{width:"100%",height:"100%",left:"0px"}}},nextClick:false,preload:4,openEffect:"none",closeEffect:"none",nextMethod:"elasticIn",nextEffect:$(".drom-notouch").length?"none":"elastic",prevMethod:"elasticOut",prevEffect:$(".drom-notouch").length?"none":"elastic",autoCenter:true,arrows:true,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',next:'<div title="Далее" class="fancybox-nav fancybox-next"><span></span></div>',prev:'<div title="Назад" class="fancybox-nav fancybox-prev"><span></span></div>',closeBtn:'<div title="Закрыть" class="fancybox-item fancybox-close"></div>'},afterClose:function(){$(".fancybox-nav").remove();$(".fancybox-close").remove();$(".fancybox-title").remove()},beforeShow:function(){var current=$.fancybox.current.element;if(current&&current.data("image-hash")){if(window.history&&window.history.pushState){fancyBoxState.changedByFancyboxNav=true;history.replaceState(undefined,undefined,"#"+current.data("image-hash"))}}if(this.element.attr("data-from-catalog")){$(".fancybox-inner").append($('<div class="b-sticker b-sticker_theme_ghost b-sticker_positioned_left-top-corner b-ico_type_book b-ico_margin_r-size-s">фото из каталога</div>'))}},afterShow:function(){if(!$(".fancybox-nav.custom-nav").length){$(".fancybox-nav").addClass("custom-nav").appendTo("body");$(".fancybox-close").addClass("custom-close").appendTo("body")}$(".fancybox-skin .fancybox-nav").remove();$(".fancybox-skin .fancybox-close").remove();fancyBoxState.changedByFancyboxNav=false;var current=$.fancybox.current.element},beforeClose:function(){var current=$.fancybox.current.element;if(current&&current.data("image-hash")){if(window.history&&window.history.pushState){history.replaceState(undefined,undefined,window.location.pathname+window.location.search);fancyBoxState.changedByFancyboxNav=false}}},onUpdate:function(){}});$(function(){function checkFancyboxHash(){if(fancyBoxState.changedByFancyboxNav){return}var imageHash=/(photo|video|panorama_inside|panorama_outside_close|panorama_outside_open)(\d+)/i,matches=[],photoNumber=0,event="click";if(window.location.hash&&imageHash.test(window.location.hash)){matches=window.location.hash.match(imageHash);if(matches&&matches.length>1){photoNumber=parseInt(matches[2]);if($("a[data-image-hash='"+matches[1]+matches[2]+"'][rel='bull']").length){$("a[data-image-hash='"+matches[1]+matches[2]+"'][rel='bull']").trigger(event)}else{if(matches[1]=="photo"){$("a[data-image-hash='"+matches[1]+matches[2]+"'][rel='fancybox_images']").trigger(event)}else{$("a[data-image-hash='"+matches[1]+matches[2]+"']").trigger(event)}}}}}$(window).on("hashchange",checkFancyboxHash);checkFancyboxHash()})}$(".newCatList:not(.sms)").on("mousedown","tr:has(td):has(a)",function(eventClick){var $this=$(this),a=$this.find('a[href*=".drom.ru/"]'),url=a.attr("href"),$target=$(eventClick.target);if($this.attr("data-row-as-link")){return}if(eventClick.which!==1&&eventClick.which!==2){return false}if($target.is("a")||$target.is("img")&&$target.parent("a").length){return true}if(typeof a==="undefined"||a.length===0){return false}if($("html").hasClass("drom-touch")){$this.on("click",function(){navigateToBull(false)});return true}navigateToBull(eventClick.which===2||eventClick.ctrlKey||eventClick.metaKey);return true;function navigateToBull(blank){if(blank){window.open(url,"_blank")}else{window.location=url}}});function getCrossBrowserTransitionEnd(){var el=document.createElement("test_transition");var transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames){if(el.style[name]!==undefined){return transEndEventNames[name]}}return false}(function($items){$.each($items,function(){var item=$(this),height=0,transitionEndEvent=getCrossBrowserTransitionEnd(),submenu=item.find(".b-menu"),timeout=null,$parent=item.parent(),isMobileMenu=false;if($parent.css("display")=="none"){$parent.css("display","block");isMobileMenu=true}submenu.css("height","auto");height=submenu.height();submenu.removeAttr("style");if(isMobileMenu){$parent.css("display","none")}item.find("a:first").bind("click",function(e){e.preventDefault()});if(submenu.length){if("ontouchstart"in window||"DocumentTouch"in window&&document instanceof DocumentTouch){submenu.data("status","close");item.find("a:first").bind("click",function(e){e.preventDefault();item.addClass("b-menu__item_hover_state");if(submenu.data("status")=="close"){submenu.data("status","open");submenu.css({height:height})}else{submenu.data("status","close");item.removeClass("b-menu__item_hover_state");submenu.css({height:0})}})}else{item.hover(function(){timeout=setTimeout(function(){submenu.css({height:height})},400)},function(){clearTimeout(timeout);submenu.css({height:0})})}}})})({main:$(".b-menu:first > .b-menu__item:last")});tryToShowNotificationForOldBrowser();$(".b-tip").on("click",function(e){e.preventDefault();e.stopPropagation();var $body=$("body");$.fn.measure=function(){var clone=this.clone(),result;clone.css({visibility:"hidden",position:"absolute"});clone.appendTo(document.body);result={width:clone.width(),height:clone.height(),outerWidth:clone.outerWidth(true),outerHeight:clone.outerHeight(true)};clone.remove();return result};var $el=$(this),$item=$el.find(".b-tip__hidden-item").clone(),$close=$item.find(".b-tip__close, .b-tip__ico"),$overlay=$('<div style="display:block;position:fixed;width:100%;'+'height:100%;top:0;left:0;z-index:9;"></div>'),posLeft=0;calculate();$(window).on("resize",calculate);$body.append($overlay);$body.append($item);$overlay.on("click",hideEl);$close.on("click",hideEl);function calculate(){var itemWidth=$item.measure().outerWidth;var docWidth=$(document).width();var elLeft=$el.offset().left;if(elLeft+itemWidth>=docWidth){posLeft=(docWidth-itemWidth)/2}else if(elLeft<docWidth/2){posLeft=elLeft-24;$item.removeClass("b-tip__hidden-item_theme_reverse")}else{posLeft=elLeft-itemWidth+30;$item.addClass("b-tip__hidden-item_theme_reverse")}$item.css({"z-index":"10",display:"block",top:$el.offset().top-24,left:posLeft})}function hideEl(e){e.stopPropagation();$overlay.remove();$item.remove();$(window).off("resize",calculate)}})});$(document).ready(function(){var execTimes=0,interval,bemBanners;var candyMockClass=".js-candy-mock";var bem_tgbs_selectors=[".b-media-cont_type_banner-text",".b-media-cont_type_banner-text-vertical",".b-media-cont_type_banner-text-small",".b-media-cont_type_banner-text-mega"];var bem_tgbs_selector=$.map(bem_tgbs_selectors,function(element){return element+":not("+candyMockClass+")"}).join(", ");bemBanners=function(){return function(){var bem_banners=$(".b-media-cont_type_banner:not("+candyMockClass+") div:first-child")||false;execTimes++;if(execTimes>5){clearInterval(interval)}if(bem_banners){bem_banners.each(function(){var b=$(this);if(b.hasClass("tire")||b.html().length>0){b.parent().show()}else if(execTimes==5){b.parent().remove()}})}if(execTimes===1){var bem_tgb_banners=$(bem_tgbs_selector).not(".js-no-process")||false;if(bem_tgb_banners){bem_tgb_banners.each(function(){var b=$(this),bTireBoss=b.find(".tireBoss")||false,bLinkHref="",bImgSrc="",bText="",bHeaderText="",bHash="",bHint="",bId=bTireBoss.attr("id"),bImg,bTitle,bHeader;if(b.hasClass("b-media-cont_type_banner-text-mega")){bImg=b.find(">.b-info-block__image>.b-image").eq(0)||false;bTitle=b.find(">.b-info-block__info>.b-info-block__title").eq(0)||false;bHeader=b.find(">.b-info-block__info>.b-info-block__header b").eq(0)||false}else{bImg=b.find(".b-image, .b-media-cont__banner-image").eq(0)||false;bTitle=b.find(".b-media-cont__banner-title .b-link, .b-info-block__title").eq(0)||false;bHeader=b.find(".b-info-block__header b").eq(0)||false}if(bImg&&bTitle&&bTireBoss){if(b.hasClass("b-media-cont_type_banner-text-mega")){bLinkHref=bTireBoss.data("url");bImgSrc=bTireBoss.data("image-src");bText=bTireBoss.data("text");bHeaderText=bTireBoss.data("title");bHash=bTireBoss.data("hash");bHint=bTireBoss.data("hint")}else{bLinkHref=bTireBoss.find("a").attr("href");bImgSrc=bTireBoss.find("a img").attr("src");bText=bTireBoss.find("p a, .b-info-block__title").text();bHeaderText=bTireBoss.find(".b-info-block__header b").text();bHash=bId;bHint=bTireBoss.find("a").attr("title")}b.attr("href",bLinkHref);b.attr("target","_blank");b.data("hash",bHash);b.attr("data-hash",bHash);b.attr("title",bHint);bImg.attr("src",bImgSrc);bTitle.text(bText);bHeader.text(bHeaderText);bTireBoss.html("").css({display:"block",position:"absolute",width:"1px",height:"1px"});removeDataAttributes(bTireBoss);if(bLinkHref!==undefined&&bImgSrc!==undefined&&bText!==undefined){showHiddenAdWrapper(b);b.show()}else{b.remove();removeEmptyAdWrappers()}}else{b.remove();removeEmptyAdWrappers()}})}}}}();bemBanners();setTimeout(function(){interval=setInterval(bemBanners,1e3)},1e3);function removeDataAttributes($element){$.each($element.data(),function(i){$element.removeAttr("data-"+i.replace(/[a-z][A-Z]/g,function(str,offset){return str[0]+"-"+str[1].toLowerCase()}))});$element.removeData()}function removeEmptyAdWrappers(){$(".js-removable-candy-wrapper").each(function(){var $self=$(this);if($self.find(bem_tgbs_selector).length===0){$self.remove()}})}function showHiddenAdWrapper($child){$child.closest(".js-removable-candy-wrapper").show()}});function gaTrackOutboundLink(section,who,event,url,is_mobile,callback){section=section||"common";var fields;var isUrl=!!url;var isAsync=isUrl&&!is_mobile;var isMobileSync=isUrl&&is_mobile;var isFollowUrlSync=false;if(typeof callback!=="function"){callback=function(){document.location=url}}if(isAsync){fields={transport:"beacon",hitCallback:callback}}else{fields={nonInteraction:true}}try{if(typeof ga=="function"&&!getCookie("no_ga")){ga("send","event",section,event,who,fields)}else{isFollowUrlSync=isUrl}}catch(e){isFollowUrlSync=isUrl}if(isFollowUrlSync||isMobileSync){callback()}}function getCrossBrowserTransitionEnd(){var el=document.createElement("test_transition");var transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames){if(el.style[name]!==undefined){return transEndEventNames[name]}}return false}(function(){var $btn=$("[data-scroll-to]");if($btn.length){$btn.bind("click",function(){$("html, body").animate({scrollTop:$($(this).attr("data-scroll-to")).offset().top})})}})();(function(){var sberCheck=document.location.hash.match(/payment\/sberbank\/check\/([0-9]+)/);if(sberCheck!==null){var sberbankOrderId=sberCheck[1];$.get("//www.drom.ru/ajax/payment/sberbank/?action=check&cb=?",{id:sberbankOrderId},function(response){if(response.status===false){alert(response.message)}else{alert(response.message)}})}})();(function(){$(function(){var selector="[data-launch-video]";if($(selector).length&&DromModal!==undefined){new DromModal({type:"youtube",trigger:selector,beforeOpen:function(){if(this.$triggerEl){var imageHash=this.$triggerEl.attr("data-image-hash")||"";if(imageHash.length>0){updateLocation("#"+imageHash)}}},beforeClose:function(){updateLocation(window.location.pathname)}})}});function updateLocation(val){if(window.history&&window.history.pushState){window.history.replaceState(undefined,undefined,val)}}})();(function($){$.extend($.easing,{easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b}});var scrollTo=function(target,duration,options,callback){if(typeof duration==="object"){options=duration;callback=options}else if(typeof duration==="function"){callback=duration}if(typeof options==="function"){callback=options}var settings=$.extend({scrollTarget:target,duration:500,offsetTop:0,easing:"easeOutCubic"},options);var $scroller=this instanceof $?this:$("html,body");return $scroller.each(function(){var scrollPane=$(this);
var scrollTarget=typeof settings.scrollTarget==="number"?settings.scrollTarget:$(settings.scrollTarget);var scrollY=typeof scrollTarget==="number"?scrollTarget:scrollTarget.offset().top-parseInt(settings.offsetTop);scrollPane.animate({scrollTop:scrollY},parseInt(settings.duration),settings.easing,function(){if(typeof callback==="function"){callback.call(this)}})})};if($.fn.scrollTo===undefined){$.fn.scrollTo=scrollTo}if($.scrollTo===undefined){$.scrollTo=scrollTo}})(jQuery);function newAutoInitCitySelectModal(url,allUrl){var spinner='<div class="b-load-spinner b-load-spinner_block-center b-load-spinner_size_m"></div>';var defaultFormHtml='<div data-region-select style="padding:20px;">'+spinner+"</div>";return new DromModal({trigger:"#new_drom_set_region",html:defaultFormHtml,beforeOpen:function(){var $container=this.tpl.$content.find("[data-region-select]");$container.html(spinner);$.ajax({url:url}).then(function(data){$container.html(data);var $allTrigger=$container.find("[data-show-all-cities]");$allTrigger.on("click",function(ev){ev.preventDefault();$container.html(spinner);$.ajax({url:allUrl}).then(function(data){$container.html(data)},function(xhr){alert("Произошла ошибка. Пожалуйста, попробуйте позже.")})})},function(xhr){alert("Произошла ошибка. Пожалуйста, попробуйте позже.")})}})}function overrideDocumentWrite(document){if(typeof document.writeclear==="function"){return}document.writeclear=document.write;document.write=function(a){if(document.body){htmlToElements(a).forEach(function(node){document.body.appendChild(node)})}else{document.writeclear(a)}};function htmlToElement(html){var template=document.createElement("template");template.innerHTML=html;return template.content.firstChild}function htmlToElements(html){var template=document.createElement("template");template.innerHTML=html;return template.content.childNodes}}$(window).on("asyncViewdir.pageChanged",function(){overrideDocumentWrite(document);$("[data-async-counter]").each(function(){var block=$(this);var content=block.html();block.empty().html(content)})});
