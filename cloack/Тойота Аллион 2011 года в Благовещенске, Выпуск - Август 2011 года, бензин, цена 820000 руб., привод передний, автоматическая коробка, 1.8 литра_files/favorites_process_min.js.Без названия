$(document).ready(function(){!function(){var t="add";$(".favorites_link").hasClass("delete_favorite")?t="del":$(".favorites_link").hasClass("add_favorite")&&(t="add");var a=$(".favorites_link"),i=$(".favorites_notification");a.length&&(i.find("a").click(function(t){t.preventDefault(),i.stop().animate({opacity:0},"slow",function(){i.css({display:"none"})})}),a.click(function(e){e.preventDefault();var s=$(this);if(s.attr("data-block-process"))return!1;s.attr("data-block-process","1");var n="",o="",l="b-button b-button_theme_beauty b-button_size_s b-ico b-ico_type_star b-ico_margin_r-size-s";"del"==t?(n="delete_favorite_bull",o=l+" add_favorite"):"add"==t&&(n="add_favorite_bull",o=l+" delete_favorite"),a.addClass("temp_ajax_loader"),$.ajax({url:"//"+$http_host+"/ajax/?mode="+n+"&crossdomain_ajax_request=3",type:"POST",dataType:"json",data:{bull_id:$bull_id},success:function(e){a.removeClass("temp_ajax_loader");var n='<span class="b-button__text b-link"> Удалить из Избранного</span></a>',l='<span class="b-button__text b-link"> Добавить в Избранное</span></a>';e.status?(a.attr("class","favorites_link"),a.addClass(o),"add"==t?(s.html(n),t="del",i.removeClass("red-notification").addClass("green-notification").css("display","block").find("span").html('Объявление добавлено в <a href="//auto.drom.ru/all/?my_favorites" target="_self" title=\'Перейти в раздел "Моё Избранное"\'>Избранное</a>')):(s.html(l),t="add",i.removeClass("red-notification").addClass("green-notification").css("display","block").find("span").html('Объявление удалено из <a href="//auto.drom.ru/all/?my_favorites" target="_self" title=\'Перейти в раздел "Моё Избранное"\'>Избранного</a>'))):(e.result.is_fav?(s.html(n),t="del"):(s.html(l),t="add"),i.removeClass("green-notification").addClass("red-notification").css("display","block").find("span").html(e.result.message)),i.stop().animate({opacity:1},"slow",function(){}),s.removeAttr("data-block-process")}})}))}(),function(){var t,a,i,e=$(".user-favorite");$(".favorite-close").click(function(s){s.preventDefault();var n,o,l,d=$(this),r=d.attr("data-bull-id");i=d.parent().parent(),n=i.attr("data-index"),o=e.find('.normal-notification[data-index="'+n+'"]'),$.ajax({url:"//auto.drom.ru/ajax/?mode=delete_favorite_bull&crossdomain_ajax_request=3",type:"POST",dataType:"json",data:{bull_id:r},success:function(s){s.status?o.length?(t=e.find('.normal-notification[data-index="'+n+'"]'),o.css("display","block"),t.css({display:"block"}),t.stop().animate({opacity:1},"fast"),i.css("display","none")):(t=$('<div class="normal-notification" data-index="'+n+'"><span>Объявление было удалено из избранного. <a class="repair-favor" href="#" data-index="'+n+'" data-bull-id="'+r+'">Восстановить объявление</a></span><a href="" class="close-btn"></a></div>'),t.css({display:"block"}),l=function(t){var t=t;return function(a){a.preventDefault();var i=$(this),e=i.attr("data-bull-id");$.ajax({url:"//auto.drom.ru/ajax/?mode=add_favorite_bull&crossdomain_ajax_request=3",type:"POST",dataType:"json",data:{bull_id:+e},success:function(a){(a.status||a.result.is_fav)&&$('tr[data-index="'+t.attr("data-index")+'"]').css("display","table-row"),t.stop().animate({opacity:0},"fast",function(){t.css("display","none")})}})}}(t),$(".all-notification").children().length&&$(".all-notification").children().remove(),$(".all-notification").append(t),t.stop().animate({opacity:1},"fast"),t.find(".close-btn").click(function(t){t.preventDefault(),$(this).parent().stop().animate({opacity:0},"fast",function(){$(this).remove(),$('tr[data-index="'+$(this).attr("data-index")+'"]').remove(),$(".row:visible").length||$(".user-favorite").parent().html('<div class="bm-add-application favorite"><table><tr><td class="pp1">В данный момент у вас в Избранном нет ни одного объявления. Чтобы запомнить заинтересовавшее вас объявление, нажмите ссылку «Добавить в Избранное» слева под фотографиями</td><td class="pp2"><div class="favor-info-img"><div class="arrow-fav"></div><img src="//c.rdrom.ru/skin/favorite-img.png"/></div></td></tr></table></div>')})}),t.find(".repair-favor").click(l),i.css("display","none")):(a=$('<div class="red-notification" data-index="'+n+'"><span>Неизвестная ошибка. Попробуйте позднее или перезагрузите страницу.</span><a href="" class="close-btn"></a></div>'),a.css({display:"block"}),$(".all-notification").children().length&&$(".all-notification").children().remove(),$(".all-notification").append(a),a.stop().animate({opacity:1},"fast"),a.find(".close-btn").click(function(t){t.preventDefault(),$(this).parent().stop().animate({opacity:0},"fast",function(){$(this).remove()})}))}})}),$(window).scroll(function(){var t=$(".all-notification");if($(".newCatList").length){var a=$(".newCatList");$(document).scrollTop()>=a.offset().top-t.height()-17?t.css({position:"fixed",left:a.offset().left,top:0,width:a.width(),"z-index":100}):t.removeAttr("style")}}),$(window).resize(function(){var t=$(".all-notification");t.attr("style")&&t.css({width:$(".newCatList").width(),left:$(".newCatList").offset().left})})}()});
